<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘é‡åå°„ç‰¹è¨“ (é¸æ“‡é¡Œç‰ˆ)</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --card: #ffffff;
            --correct: #22c55e;
            --wrong: #ef4444;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header-panel {
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card);
            padding: 15px 20px;
            border-radius: 10px;
            position: sticky;
            top: 10px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .score {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
        }

        button.refresh-btn {
            background: var(--text);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        button.refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .question-card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 5px solid transparent;
            transition: all 0.3s;
        }

        .question-card.answered-correct { border-left-color: var(--correct); }
        .question-card.answered-wrong { border-left-color: var(--wrong); }

        .q-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .option-btn {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            text-align: center;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--primary);
            background: #eff6ff;
        }

        /* ç‹€æ…‹æ¨£å¼ */
        .option-btn.correct {
            background-color: #dcfce7 !important;
            border-color: var(--correct) !important;
            color: #14532d;
            font-weight: bold;
        }

        .option-btn.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--wrong) !important;
            color: #7f1d1d;
            opacity: 0.7;
        }

        .option-btn.disabled {
            cursor: default;
            pointer-events: none;
        }

        .section-title {
            margin: 30px 0 15px 0;
            font-size: 1.3rem;
            color: var(--text);
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 5px;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header-panel">
        <h1 style="margin:0">å‘é‡åå°„ç‰¹è¨“ (é¸æ“‡é¡Œç‰ˆ)</h1>
        <p style="margin:5px 0 0 0; opacity:0.9">50 é¡Œæ¥µé€Ÿåæ‡‰è¨“ç·´</p>
    </div>

    <div class="controls">
        <div class="score">å¾—åˆ†: <span id="currentScore">0</span> / 50é¡Œ</div>
        <button class="refresh-btn" onclick="generateExam()">ğŸ”„ é‡æ–°å‡ºé¡Œ</button>
    </div>

    <div id="quiz-area"></div>
</div>

<script>
    // å·¥å…·å‡½å¼
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    
    // ç•¢æ°æ•¸ç”Ÿæˆå™¨ (ç¢ºä¿é•·åº¦æ˜¯æ•´æ•¸)
    const triples = [[3,4,5], [5,12,13], [8,15,17], [7,24,25], [20,21,29]];
    const getPythagoreanVector = () => {
        const t = triples[rand(0, triples.length - 1)];
        let a = t[0], b = t[1];
        if(Math.random() > 0.5) [a, b] = [b, a]; // äº¤æ› xy
        a *= (Math.random() > 0.5 ? 1 : -1);     // éš¨æ©Ÿæ­£è² 
        b *= (Math.random() > 0.5 ? 1 : -1);
        return {x: a, y: b, len: t[2]};
    };

    let questions = [];
    let totalScore = 0;

    // ç”Ÿæˆé¡Œç›®
    function generateExam() {
        const container = document.getElementById('quiz-area');
        container.innerHTML = '<div style="text-align:center; padding:20px">é¡Œç›®ç”Ÿæˆä¸­...</div>';
        questions = [];
        totalScore = 0;
        document.getElementById('currentScore').innerText = 0;

        // --- é¡Œåº«ç”Ÿæˆé‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒï¼Œä½†é©é…é¸æ“‡é¡Œ) ---
        
        // 1. åº§æ¨™è¡¨ç¤ºæ³•
        for(let i=0; i<5; i++) {
            const x = rand(-9, 9), y = rand(-9, 9);
            addQ("ä¸€ã€å‘é‡åº§æ¨™è¡¨ç¤ºæ³•", 
                 `å‘é‡ \\(\\vec{v}\\) å§‹é»ç‚º (0,0)ï¼Œçµ‚é»ç‚º (${x}, ${y})ï¼Œæ±‚ \\(\\vec{v}\\)`, 
                 [x, y]);
        }
        addQ("ä¸€ã€å‘é‡åº§æ¨™è¡¨ç¤ºæ³•", `å‘é‡ \\(\\vec{a}\\) å°‡åŸé»å¹³ç§»è‡³ P(-3, 5)ï¼Œæ±‚ \\(\\vec{a}\\)`, [-3, 5]);

        // 2. åˆ†é‡åˆ¤æ–·
        for(let i=0; i<6; i++) {
            const x = rand(-9, 9), y = rand(-9, 9);
            const isX = Math.random() > 0.5;
            addQ("äºŒã€åˆ†é‡åˆ¤æ–·", 
                 `å‘é‡ (${x}, ${y}) çš„ ${isX ? 'x (æ°´å¹³)' : 'y (é‰›ç›´)'} åˆ†é‡ç‚ºä½•ï¼Ÿ`, 
                 isX ? x : y, 'scalar');
        }

        // 3. é•·åº¦è¨ˆç®—
        for(let i=0; i<6; i++) {
            if(Math.random() > 0.4) {
                const v = getPythagoreanVector();
                addQ("ä¸‰ã€å‘é‡å¤§å° (é•·åº¦)", `æ±‚å‘é‡ (${v.x}, ${v.y}) çš„é•·åº¦`, v.len, 'scalar');
            } else {
                const val = rand(2, 8);
                const isX = Math.random() > 0.5;
                addQ("ä¸‰ã€å‘é‡å¤§å° (é•·åº¦)", `æ±‚å‘é‡ (${isX ? val : 0}, ${isX ? 0 : val}) çš„é•·åº¦`, val, 'scalar');
            }
        }

        // 4. åå‘é‡
        for(let i=0; i<6; i++) {
            const x = rand(-9, 9), y = rand(-9, 9);
            addQ("å››ã€åå‘é‡", `\\(\\vec{u} = (${x}, ${y})\\)ï¼Œæ±‚ \\(-\\vec{u}\\)`, [-x, -y]);
        }

        // 5. ä¿‚æ•¸ç©
        for(let i=0; i<6; i++) {
            const x = rand(-5, 5), y = rand(-5, 5);
            const k = randSign() * rand(2, 4);
            addQ("äº”ã€ä¿‚æ•¸ç©", `\\(\\vec{a} = (${x}, ${y})\\)ï¼Œæ±‚ \\(${k}\\vec{a}\\)`, [k*x, k*y]);
        }

        // 6. å…©é»æ±‚å‘é‡
        for(let i=0; i<8; i++) {
            const x1 = rand(-5, 5), y1 = rand(-5, 5);
            const x2 = rand(-5, 5), y2 = rand(-5, 5);
            addQ("å…­ã€å…©é»æ±‚å‘é‡ (çµ‚-å§‹)", `A(${x1}, ${y1}), B(${x2}, ${y2})ï¼Œæ±‚ \\(\\vec{AB}\\)`, [x2-x1, y2-y1]);
        }

        // 7. åŠ æ³•
        for(let i=0; i<6; i++) {
            const x1 = rand(-5, 5), y1 = rand(-5, 5);
            const x2 = rand(-5, 5), y2 = rand(-5, 5);
            addQ("ä¸ƒã€å‘é‡ç›¸åŠ ", `(${x1}, ${y1}) + (${x2}, ${y2}) = ?`, [x1+x2, y1+y2]);
        }

        // 8. æ¸›æ³•
        for(let i=0; i<6; i++) {
            const x1 = rand(-5, 5), y1 = rand(-5, 5);
            const x2 = rand(-5, 5), y2 = rand(-5, 5);
            addQ("å…«ã€å‘é‡ç›¸æ¸›", `(${x1}, ${y1}) - (${x2}, ${y2}) = ?`, [x1-x2, y1-y2]);
        }

        renderExam();
    }

    // è¼”åŠ©ï¼šéš¨æ©Ÿæ­£è² 
    function randSign() { return Math.random() < 0.5 ? -1 : 1; }

    // åŠ å…¥é¡Œç›® (è‡ªå‹•ç”Ÿæˆé¸é …)
    function addQ(section, text, correctVal, type = 'vector') {
        const opts = generateOptions(correctVal, type);
        questions.push({
            id: questions.length,
            section,
            text,
            correct: formatVal(correctVal, type),
            options: opts,
            answered: false
        });
    }

    // ç”Ÿæˆèª˜ç­”é¸é … (Distractors)
    function generateOptions(correct, type) {
        let set = new Set();
        const correctStr = formatVal(correct, type);
        set.add(correctStr);

        let attempts = 0;
        while(set.size < 4 && attempts < 50) {
            let wrong;
            if (type === 'vector') {
                const [cx, cy] = correct;
                // ç”ŸæˆéŒ¯èª¤é‚è¼¯ï¼šè®Šè™Ÿã€XYäº’æ›ã€å–®é‚Šè®Šè™Ÿã€åŠ æ¸›1
                const r = Math.random();
                if(r < 0.2) wrong = [cy, cx]; // XY äº’æ›
                else if(r < 0.4) wrong = [-cx, -cy]; // å…¨è®Šè™Ÿ
                else if(r < 0.6) wrong = [cx, -cy]; // Yè®Šè™Ÿ
                else if(r < 0.8) wrong = [-cx, cy]; // Xè®Šè™Ÿ
                else wrong = [cx + randSign(), cy + randSign()]; // æ•¸å€¼å¾®èª¿
                set.add(formatVal(wrong, 'vector'));
            } else {
                // ç´”é‡éŒ¯èª¤ï¼šåŠ æ¸›ã€è®Šè™Ÿ
                const v = correct;
                const r = Math.random();
                if(r < 0.3) set.add(formatVal(-v, 'scalar'));
                else set.add(formatVal(v + randSign() * rand(1, 3), 'scalar'));
            }
            attempts++;
        }
        
        // å¦‚æœç”Ÿä¸å‡ºè¶³å¤ çš„éŒ¯èª¤é¸é …ï¼ˆä¾‹å¦‚ç­”æ¡ˆæ˜¯0ï¼‰ï¼Œè£œéš¨æ©Ÿæ•¸
        while(set.size < 4) {
             if(type === 'vector') set.add(`(${rand(-10,10)}, ${rand(-10,10)})`);
             else set.add(`${rand(-10,10)}`);
        }

        return Array.from(set).sort(() => Math.random() - 0.5); // æ‰“äº‚é †åº
    }

    function formatVal(val, type) {
        if(type === 'vector') return `(${val[0]}, ${val[1]})`;
        return `${val}`;
    }

    // æ¸²æŸ“ HTML
    function renderExam() {
        const container = document.getElementById('quiz-area');
        container.innerHTML = '';
        
        let currentSection = '';

        questions.forEach((q, index) => {
            if(q.section !== currentSection) {
                const h = document.createElement('h2');
                h.className = 'section-title';
                h.textContent = q.section;
                container.appendChild(h);
                currentSection = q.section;
            }

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${index}`;

            const title = document.createElement('div');
            title.className = 'q-title';
            title.innerHTML = `${index+1}. ${q.text}`;

            const grid = document.createElement('div');
            grid.className = 'options-grid';

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(index, opt, btn);
                grid.appendChild(btn);
            });

            card.appendChild(title);
            card.appendChild(grid);
            container.appendChild(card);
        });

        // é‡è¦ï¼šé€šçŸ¥ MathJax é‡æ–°æ¸²æŸ“æ•¸å­¸ç¬¦è™Ÿ
        if(window.MathJax) {
            MathJax.typeset();
        }
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer(qIdx, selectedVal, btnElem) {
        const q = questions[qIdx];
        if(q.answered) return; // é˜²æ­¢é‡è¤‡ä½œç­”

        q.answered = true;
        const card = document.getElementById(`q-card-${qIdx}`);
        const allBtns = card.querySelectorAll('.option-btn');

        // é–å®šæ‰€æœ‰æŒ‰éˆ•
        allBtns.forEach(b => b.classList.add('disabled'));

        if(selectedVal === q.correct) {
            btnElem.classList.add('correct');
            card.classList.add('answered-correct');
            totalScore++;
            updateScore();
        } else {
            btnElem.classList.add('wrong');
            card.classList.add('answered-wrong');
            // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
            allBtns.forEach(b => {
                if(b.textContent === q.correct) b.classList.add('correct');
            });
        }
    }

    function updateScore() {
        const el = document.getElementById('currentScore');
        el.innerText = totalScore;
        el.style.transform = "scale(1.2)";
        setTimeout(() => el.style.transform = "scale(1)", 200);
    }

    // åˆå§‹åŒ–
    window.onload = generateExam;

</script>
</body>
</html>
